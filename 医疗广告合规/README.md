# åŒ»ç–—å¹¿å‘Šåˆè§„æ£€æµ‹ç³»ç»Ÿ

![License](https://img.shields.io/badge/license-MIT-blue.svg)
![Python](https://img.shields.io/badge/python-3.8%2B-blue.svg)
![Streamlit](https://img.shields.io/badge/streamlit-1.0%2B-green.svg)

ä¸€ä¸ªé«˜æ•ˆçš„åŒ»ç–—å¹¿å‘Šæ–‡æœ¬åˆè§„æ€§æ£€æµ‹ç³»ç»Ÿï¼Œé‡‡ç”¨å¤šå±‚æ£€æµ‹ç­–ç•¥ï¼ˆè§„åˆ™åŒ¹é…ã€è¯­ä¹‰åˆ†æã€BERT åˆ†ç±»ï¼‰ç¡®ä¿æ£€æµ‹ç²¾åº¦ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- âš¡ **å¿«é€Ÿæ£€æµ‹**ï¼šå¿«é€Ÿç‰ˆæœ¬ 2 ç§’å†…åŠ è½½
- ğŸ” **å¤šå±‚æ£€æµ‹**ï¼šè§„åˆ™ + è¯­ä¹‰ç›¸ä¼¼åº¦ + BERT åˆ†ç±»
- ğŸ“¸ **OCR æ”¯æŒ**ï¼šTesseractã€ç™¾åº¦ã€é˜¿é‡Œäº‘ API
- ğŸ¨ **å¯è§†åŒ–æŠ¥å‘Š**ï¼šè¿è§„è¯çº¢è‰²æ ‡è®°ã€è¯¦ç»†æ•°æ®ç»Ÿè®¡
- ğŸ“ **æ‰¹é‡å¤„ç†**ï¼šæ”¯æŒæ‰¹é‡æ–‡ä»¶æ£€æµ‹
- ğŸ’¾ **æ•°æ®å­˜å‚¨**ï¼šSQLite æ•°æ®åº“è‡ªåŠ¨ä¿å­˜å†å²
- âš™ï¸ **è§„åˆ™ç®¡ç†**ï¼šWeb ç•Œé¢ç¼–è¾‘æ£€æµ‹è§„åˆ™
- ğŸŒ **äº‘ç«¯éƒ¨ç½²**ï¼šæ”¯æŒå¤šç§éƒ¨ç½²æ–¹æ¡ˆ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æœ¬åœ°è¿è¡Œï¼ˆä¸€é”®å¯åŠ¨ï¼‰

**Windowsï¼š**
```powershell
.\start.bat
```

**Linux/Macï¼š**
```bash
chmod +x start.sh
./start.sh
```

### æ‰‹åŠ¨å¯åŠ¨

1. **å®‰è£…ä¾èµ–**
```powershell
python -m venv venv
venv\Scripts\activate  # Windows
# source venv/bin/activate  # Linux/Mac
pip install -r requirements.txt
```

2. **å¯åŠ¨åº”ç”¨**
```powershell
streamlit run app_lite.py      # å¿«é€Ÿç‰ˆï¼ˆæ¨èï¼‰
# streamlit run app.py         # å®Œæ•´ç‰ˆ
```

3. **è®¿é—®åº”ç”¨**
- æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:8501

### å‘½ä»¤è¡Œä½¿ç”¨

```powershell
# æ–‡æœ¬æ£€æµ‹
python main.py --input "æœ¬äº§å“ä¿è¯æ²»æ„ˆï¼Œç™¾åˆ†ä¹‹ç™¾å®‰å…¨" --type text

# å›¾ç‰‡ OCR æ£€æµ‹
python main.py --input test.jpg --type image

# è‡ªå®šä¹‰ Tesseract è·¯å¾„ï¼ˆWindowsï¼‰
python main.py --input test.jpg --type image --tesseract-cmd "C:\Program Files\Tesseract-OCR\tesseract.exe"
```

å¦‚æœ tesseract ä¸åœ¨ PATHï¼Œä½¿ç”¨ï¼š

```powershell
python main.py -i test.jpg -t image --tesseract-cmd "C:\\Program Files\\Tesseract-OCR\\tesseract.exe"
```

ä¹Ÿå¯ä»¥é€‰æ‹©ç¬¬ä¸‰æ–¹ OCRï¼ˆéœ€åœ¨ä»£ç ä¸­å®ç° API è°ƒç”¨å¹¶æä¾›å‡­æ®ï¼‰ï¼š

```powershell
python main.py -i test.jpg -t image --ocr-provider baidu
```

5. è¾“å‡ºï¼šç¨‹åºä¼šæ‰“å° JSON æŠ¥å‘Šï¼Œå¹¶åœ¨ `reports/` ç›®å½•ä¸‹ä¿å­˜ä¸€ä¸ªæŠ¥å‘Šæ–‡ä»¶ã€‚

## ğŸ“¦ éƒ¨ç½²æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šStreamlit Cloudï¼ˆæ¨è - 3 åˆ†é’Ÿå¿«é€Ÿåˆ†äº«ï¼‰

**æœ€ç®€å•ï¼ä¸€è¡Œå‘½ä»¤è®©æ‰€æœ‰äººéƒ½èƒ½ä½¿ç”¨ï¼š**

1. ä¸Šä¼ åˆ° GitHub
   ```bash
   git add .
   git commit -m "initial"
   git push origin main
   ```

2. åœ¨ [Streamlit Cloud](https://streamlit.io/cloud) éƒ¨ç½²
   - é€‰æ‹©ä»“åº“
   - æŒ‡å®š `app_lite.py`
   - Deploy

3. è·å¾—å…¬å¼€é“¾æ¥ï¼š`https://xxx.streamlit.app/`

### æ–¹æ¡ˆ 2ï¼šDocker éƒ¨ç½²ï¼ˆæ¨èä¼ä¸šéƒ¨ç½²ï¼‰

```bash
docker build -t medical-compliance .
docker run -p 8501:8501 medical-compliance
# è®¿é—® http://localhost:8501
```

### æ–¹æ¡ˆ 3ï¼šæœ¬åœ° LAN å…±äº«ï¼ˆå±€åŸŸç½‘å†…ä½¿ç”¨ï¼‰

```powershell
streamlit run app_lite.py --server.address=0.0.0.0
# å…¶ä»–ç”µè„‘è®¿é—®ï¼šhttp://YOUR_IP:8501
```

[ğŸ“– æŸ¥çœ‹å®Œæ•´éƒ¨ç½²æŒ‡å— â†’](./DEPLOYMENT.md)

## ğŸ“Š ç³»ç»Ÿæ¶æ„

```
è¾“å…¥æ–‡æœ¬/å›¾ç‰‡
    â†“
[1] OCR æå– (Tesseract/API)
    â†“
[2] è§„åˆ™åŒ¹é… (æ­£åˆ™è¡¨è¾¾å¼)
    â†“
[3] æ•æ„Ÿè¯æ£€æµ‹ (å­—å…¸åŒ¹é…)
    â†“
[4] è¯­ä¹‰ç›¸ä¼¼åº¦ (Sentence-Transformers BERT)
    â†“
[5] åˆ†ç±»å™¨ (å¾®è°ƒ BERT)
    â†“
åˆè§„æ€§æŠ¥å‘Š (JSON)
```

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | å¿«é€Ÿç‰ˆ | å®Œæ•´ç‰ˆ |
|-----|-------|--------|
| **åŠ è½½æ—¶é—´** | < 2 ç§’ | 10-30 ç§’ |
| **å•æ¬¡æ£€æµ‹** | 100ms | 500ms |
| **æ‰¹é‡å¤„ç†** | 1000 æ¡/åˆ†é’Ÿ | 200 æ¡/åˆ†é’Ÿ |
| **å†…å­˜å ç”¨** | 100MB | 4GB |

### ç‰ˆæœ¬é€‰æ‹©

**å¿«é€Ÿç‰ˆ** (`app_lite.py`) - æ¨èé¦–å…ˆä½¿ç”¨ï¼š
- ä»…ä½¿ç”¨è¿è§„è§„åˆ™ + æ•æ„Ÿè¯æ­£åˆ™æ£€æµ‹
- å¯åŠ¨æ—¶é—´ < 2 ç§’ï¼Œæ£€æµ‹ < 1 ç§’
- æ— éœ€åŠ è½½ä»»ä½•æœºå™¨å­¦ä¹ æ¨¡å‹
- é€‚åˆå¿«é€Ÿæ‰¹é‡æ£€æµ‹æˆ–ç½‘ç»œæ¡ä»¶è¾ƒå¼±çš„ç¯å¢ƒ

**å®Œæ•´ç‰ˆ** (`app.py`) - åŠŸèƒ½æœ€å…¨ï¼š
- åŒ…å«è§„åˆ™æ£€æµ‹ + è¯­ä¹‰ç›¸ä¼¼åº¦ + åˆ†ç±»å™¨
- é¦–æ¬¡å¯åŠ¨ 10-30 ç§’ï¼ˆåŠ è½½æ¨¡å‹ï¼‰ï¼Œä¹‹å < 5 ç§’
- è‡ªåŠ¨ç¼“å­˜æ¨¡å‹ï¼Œåç»­è°ƒç”¨é«˜é€Ÿ
- ä¾§è¾¹æ å¯é€‰æ‹©å¯ç”¨/ç¦ç”¨å„æ£€æµ‹æ¨¡å—

### è‹¥é‡åˆ°è¶…æ—¶

1. **ç«‹å³å°è¯•**ï¼š
   ```powershell
   streamlit run app_lite.py
   ```
   è¿™ä¸ªç‰ˆæœ¬åº”è¯¥èƒ½ç§’é€ŸåŠ è½½ã€‚

2. **è‹¥éœ€å®Œæ•´åŠŸèƒ½**ï¼Œä½¿ç”¨ `app.py` ä½†**ç¦ç”¨è¯­ä¹‰æ£€æµ‹**ï¼š
   - å¯åŠ¨ `streamlit run app.py`
   - åœ¨ä¾§è¾¹æ **å–æ¶ˆå‹¾é€‰**"å¯ç”¨è¯­ä¹‰ç›¸ä¼¼åº¦æ£€æµ‹"
   - åªå¯ç”¨è§„åˆ™åŒ¹é…å’Œåˆ†ç±»å™¨ï¼Œå¿«é€Ÿå®Œæˆ

3. **ç¯å¢ƒè¦æ±‚æ£€æŸ¥**ï¼š
   - ç¡®ä¿ç½‘ç»œè¿æ¥è‰¯å¥½ï¼ˆé¦–æ¬¡ä¼šä¸‹è½½æ¨¡å‹ï¼‰
   - å»ºè®®è‡³å°‘ 2GB å¯ç”¨å†…å­˜
   - GPU å¯é€‰ä½†ä¸å¿…éœ€ï¼ˆCPU ä¹Ÿèƒ½è¿è¡Œï¼‰

è¯´æ˜ï¼š
- å¦‚æœè¦ä½¿ç”¨ç™¾åº¦/é˜¿é‡Œ OCRï¼Œè¯·åœ¨ `utils/ocr.py` ä¸­å®ç°å¯¹åº” API è°ƒç”¨ï¼ˆå·²ç•™å ä½ï¼‰ã€‚
- è¯­ä¹‰æ¨¡å‹é»˜è®¤ä½¿ç”¨ `paraphrase-multilingual-MiniLM-L12-v2`ï¼Œå¯ä»¥åœ¨ `utils/semantic.py` ä¸­æ›¿æ¢ä¸ºå…¶ä»– Hugging Face æ¨¡å‹ã€‚

Web åº”ç”¨ç‰¹æ€§ï¼š
- æ”¯æŒæ–‡æœ¬ç›´æ¥è¾“å…¥æˆ–å›¾ç‰‡ä¸Šä¼ ï¼Œè‡ªåŠ¨è¿›è¡Œ OCR è¯†åˆ«ã€‚
- å¤šå±‚çº§æ£€æµ‹ï¼šè¿è§„è§„åˆ™åŒ¹é…ã€æ•æ„Ÿè¯æ­£åˆ™åŒ¹é…ã€è¯­ä¹‰ç›¸ä¼¼åº¦æ£€æµ‹ã€å¾®è°ƒåˆ†ç±»å™¨é¢„æµ‹ã€‚
- å®æ—¶æ˜¾ç¤ºè¯¦ç»†æ£€æµ‹ç»“æœï¼ˆæ ‡ç­¾é¡µåˆ†ç±»ï¼‰ã€‚
- æ”¯æŒä¸‹è½½å®Œæ•´æ£€æµ‹æŠ¥å‘Šï¼ˆJSON æ ¼å¼ï¼‰ã€‚
- ä¾§è¾¹æ é…ç½®é¡¹ï¼šè°ƒæ•´è¯­ä¹‰é˜ˆå€¼ã€å¯ç”¨/ç¦ç”¨å„æ£€æµ‹æ¨¡å—ã€‚
- **æ–°å¢åŠŸèƒ½**ï¼š
  - **æ•°æ®åº“å†å²å­˜å‚¨**ï¼šè‡ªåŠ¨ä¿å­˜æ‰€æœ‰æ£€æµ‹æŠ¥å‘Šåˆ° `reports.db` SQLite æ•°æ®åº“ã€‚
  - **å†å²æŠ¥å‘ŠæŸ¥è¯¢**ï¼šæŸ¥çœ‹å†å²æ£€æµ‹æ•°æ®ã€ç»Ÿè®¡ä¿¡æ¯ã€ä¸‹è½½å•æ¡æŠ¥å‘Šæˆ–æ‰¹é‡åˆ é™¤ã€‚
  - **è§„åˆ™ç®¡ç†**ï¼šåœ¨ Web ç•Œé¢ç›´æ¥ç¼–è¾‘ã€ä¸Šä¼ è¿è§„è§„åˆ™å’Œæ•æ„Ÿè¯è§„åˆ™æ–‡ä»¶ã€‚
  - **æ‰¹é‡æ£€æµ‹**ï¼šæ”¯æŒä¸Šä¼ æ–‡æœ¬æ–‡ä»¶ï¼ˆTXT/CSVï¼Œæ¯è¡Œä¸€æ¡ï¼‰è¿›è¡Œæ‰¹é‡æ£€æµ‹ï¼Œç”Ÿæˆç»Ÿè®¡æŠ¥å‘Šå¹¶ä¸‹è½½ã€‚

è®­ç»ƒ classifierï¼ˆç¤ºä¾‹ï¼‰

1. å‡†å¤‡æ•°æ®ï¼šåœ¨ `data/train.csv` å’Œ `data/val.csv` ä¸­å‡†å¤‡ä¸¤åˆ— `text,label`ï¼ˆlabel: 0 åˆè§„ï¼Œ1 è¿è§„ï¼‰ã€‚ç¤ºä¾‹æ•°æ®å·²åŒ…å«åœ¨ä»“åº“ä¸­ã€‚

2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£…ä¾èµ–ï¼š

```powershell
python -m venv .venv
.\.venv\Scripts\Activate.ps1
pip install -r requirements.txt
```

3. è¿è¡Œè®­ç»ƒï¼ˆä½¿ç”¨ `bert-base-chinese` æˆ– `uer/bert-base-chinese-cluecorpussmall`ï¼‰ï¼š

```powershell
python train_classifier.py --model_name uer/bert-base-chinese-cluecorpussmall --epochs 3 --batch_size 8
```

è®­ç»ƒå®Œæˆåæ¨¡å‹ä¼šä¿å­˜åœ¨ `models/violation_classifier`ï¼Œå¯ä»¥é€šè¿‡ `utils/classifier.py` ä¸­çš„ `predict_text()` è¿›è¡Œæ¨ç†ã€‚

ç¤ºä¾‹æ¨ç†ï¼š

```python
from utils.classifier import predict_text
print(predict_text("æœ¬å“å¯ä»¥æ ¹æ²»æ‰€æœ‰ç–¾ç—…ï¼Œç™¾åˆ†ç™¾æœ‰æ•ˆ"))
```

æ³¨æ„ï¼šè®­ç»ƒéœ€è¦ GPU æ‰èƒ½å¿«é€Ÿå®Œæˆï¼ŒCPU ä¸‹è®­ç»ƒä¼šè¾ƒæ…¢ã€‚æ ¹æ®æ•°æ®é‡ä¸éœ€æ±‚è°ƒæ•´ `epochs`ã€`batch_size` ä¸ `max_length`ã€‚

ä¸‹ä¸€æ­¥å»ºè®®ï¼š
- å°†æ•æ„Ÿè§„åˆ™æŠ½è±¡ä¸ºå¯ç¼–è¾‘çš„ JSON/æ•°æ®åº“é…ç½®å¹¶æä¾›ç®¡ç†ç•Œé¢ã€‚
- ä¸ºè¯­ä¹‰æ£€æµ‹å‡†å¤‡æ›´å¤šçš„æ•æ„Ÿç¤ºä¾‹å¹¶å¯é€‰åœ°åœ¨æœ¬åœ°å¾®è°ƒåˆ†ç±»å™¨ä»¥æé«˜å‡†ç¡®æ€§ã€‚
- åœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½² API æœåŠ¡ï¼ˆFastAPIï¼‰æˆ–æ‰©å±• Web åº”ç”¨åŠŸèƒ½ã€‚

#### æ–°å¢åŠŸèƒ½è¯¦è§£

##### 1. æ•°æ®åº“å†å²å­˜å‚¨ï¼ˆ`utils/database.py`ï¼‰

- è‡ªåŠ¨å°†æ‰€æœ‰æ£€æµ‹æŠ¥å‘Šä¿å­˜åˆ° `reports.db`ï¼ˆSQLiteï¼‰ã€‚
- å­—æ®µåŒ…æ‹¬ï¼šæ£€æµ‹æ–‡æœ¬ã€OCR æ–‡æœ¬ã€åˆ¤å®šç»“æœã€è¿è§„æ•°é‡ã€å®Œæ•´æŠ¥å‘Š JSONã€åˆ›å»ºæ—¶é—´ã€‚
- æä¾›ç»Ÿè®¡æ¥å£ï¼šæŸ¥è¯¢æ€»æ£€æµ‹æ•°ã€åˆè§„æ•°ã€è¿è§„æ•°ç­‰ã€‚

##### 2. å†å²æŠ¥å‘ŠæŸ¥è¯¢ï¼ˆ`å†å²æŠ¥å‘Š` é¡µé¢ï¼‰

- æŸ¥çœ‹æœ€è¿‘ 100 æ¡æ£€æµ‹å†å²ã€‚
- å¿«é€Ÿé¢„è§ˆï¼šæ–‡æœ¬æ‘˜è¦ï¼ˆå‰ 60 å­—ï¼‰ã€åˆ¤å®šç»“æœã€è¿è§„æ•°é‡ã€‚
- ç‚¹å‡»"ğŸ‘ï¸ æŸ¥çœ‹"å±•å¼€å®Œæ•´æŠ¥å‘Šè¯¦æƒ…ï¼ˆJSON æ ¼å¼ï¼‰ã€‚
- ä¸‹è½½å•æ¡æŠ¥å‘Šæˆ–åˆ é™¤å†å²è®°å½•ã€‚

##### 3. è§„åˆ™ç®¡ç†ï¼ˆ`è§„åˆ™ç®¡ç†` é¡µé¢ï¼‰

- **ç¼–è¾‘è§„åˆ™**ï¼šç›´æ¥åœ¨æ–‡æœ¬æ¡†ä¸­ç¼–è¾‘ `violation_rules.txt` æˆ– `sensitive_words.txt`ã€‚
- **ä¸Šä¼ è§„åˆ™**ï¼šé€šè¿‡æ–‡ä»¶ä¸Šä¼ æ›¿æ¢è§„åˆ™æ–‡ä»¶ã€‚
- **å®æ—¶é¢„è§ˆ**ï¼šæ˜¾ç¤ºå½“å‰è§„åˆ™æ€»æ•°ä¸å‰ 20 æ¡è§„åˆ™å†…å®¹ã€‚
- ä¿®æ”¹å³æ—¶ä¿å­˜ï¼Œæ— éœ€é‡å¯åº”ç”¨ã€‚

##### 4. æ‰¹é‡æ£€æµ‹ï¼ˆ`æ‰¹é‡æ£€æµ‹` é¡µé¢ï¼‰

- ä¸Šä¼  TXT æˆ– CSV æ–‡ä»¶ï¼ˆæ¯è¡Œä¸€æ¡å¾…æ£€æµ‹æ–‡æœ¬ï¼‰ã€‚
- å®æ—¶æ˜¾ç¤ºå¤„ç†è¿›åº¦æ¡ã€‚
- é€æ¡æ£€æµ‹å¹¶æ±‡æ€»ç»Ÿè®¡ï¼šæ€»æ•°ã€åˆè§„æ•°ã€è¿è§„æ•°ã€‚
- ä¸‹è½½æ‰¹é‡ç»“æœï¼ˆJSON æ ¼å¼ï¼‰ã€‚

#### æ–‡ä»¶ç»“æ„

```
åŒ»ç–—å¹¿å‘Šåˆè§„/
â”œâ”€â”€ app.py                              # Streamlit ä¸»åº”ç”¨ï¼ˆæ–°å¢é¡µé¢ï¼šæ‰¹é‡æ£€æµ‹ã€å†å²æŠ¥å‘Šã€è§„åˆ™ç®¡ç†ï¼‰
â”œâ”€â”€ main.py                             # å‘½ä»¤è¡Œå·¥å…·
â”œâ”€â”€ train_classifier.py                 # åˆ†ç±»å™¨å¾®è°ƒè„šæœ¬
â”œâ”€â”€ config.py                           # é…ç½®æ–‡ä»¶
â”œâ”€â”€ requirements.txt                    # ä¾èµ–ï¼ˆæ–°å¢ streamlitï¼‰
â”œâ”€â”€ violation_rules.txt                 # è¿è§„è§„åˆ™åº“
â”œâ”€â”€ sensitive_words.txt                 # æ•æ„Ÿè¯è§„åˆ™åº“
â”œâ”€â”€ reports.db                          # SQLite æ•°æ®åº“ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ train.csv                       # è®­ç»ƒæ•°æ®é›†
â”‚   â””â”€â”€ val.csv                         # éªŒè¯æ•°æ®é›†
â”œâ”€â”€ models/
â”‚   â””â”€â”€ violation_classifier/           # å¾®è°ƒåçš„æ¨¡å‹ï¼ˆè®­ç»ƒåç”Ÿæˆï¼‰
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ ocr.py                          # OCR æ¨¡å—ï¼ˆTesseractï¼‰
â”‚   â”œâ”€â”€ text_processing.py              # æ–‡æœ¬å¤„ç†ï¼ˆåˆ†è¯ã€æ­£åˆ™åŒ¹é…ï¼‰
â”‚   â”œâ”€â”€ semantic.py                     # è¯­ä¹‰ç›¸ä¼¼åº¦ï¼ˆSentence-Transformersï¼‰
â”‚   â”œâ”€â”€ classifier.py                   # åˆ†ç±»å™¨æ¨ç†
â”‚   â””â”€â”€ database.py                     # æ•°æ®åº“æ“ä½œï¼ˆæ–°å¢ï¼‰
â””â”€â”€ reports/                            # æ£€æµ‹æŠ¥å‘Šè¾“å‡ºç›®å½•
```
